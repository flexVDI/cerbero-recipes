# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python


class Recipe(recipe.Recipe):
    name = 'boost'
    version = '1.50.0'
    licenses = [License.GPLv2Plus]
    stype = SourceType.TARBALL
    btype = BuildType.CUSTOM
    _version = version.replace('.', '_')
    url = 'sf://%(name)s/%(version)s/%(name)s_{0}.tar.bz2'.format(_version)
    tarball_checksum = 'c9ace2b8c81fa6703d1d17c7e478de3bc51101c5adbdeb3f6cb72cf3045a8529'
    tarball_dirname = 'boost_1_50_0'

    def compile(self):
        libraries = [
            'system',
            'thread',
            'test'
        ]
        shell.call('./bootstrap.sh --prefix={0} --with-libraries={1}'.format(
                   self.config.prefix, ','.join(libraries)), self.build_dir)

    def install(self):
        options = ''
        if self.config.target_platform == Platform.WINDOWS:
            options = 'target-os=windows'
            user_config = os.path.join(self.build_dir, 'tools', 'build', 'v2', 'user-config.jam')
            gxx = os.path.join(self.config.toolchain_prefix, 'bin', 'x86_64-w64-mingw32-g++')
            opts = ': <compileflags>-m32 <linkflags>-m32 ' if self.config.target_arch == Architecture.X86 else ''
            with open(user_config, 'w') as f:
                f.write('using gcc : : {} {};'.format(gxx, opts))
        shell.call('./b2 {0} variant=release install'.format(options), self.build_dir)
